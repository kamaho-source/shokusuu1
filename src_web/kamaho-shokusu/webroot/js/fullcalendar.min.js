var n, r, i, o = this.view,
    s = o.calendar,
    a = t.footprint.componentFootprint,
    l = a.isAllDay,
    d = t.footprint.eventDef,
    c = o.isEventDefDraggable(d),
    p = !e && t.isStart && o.isEventDefResizableFromStart(d),
    h = !e && t.isEnd && o.isEventDefResizableFromEnd(d),
    f = this.getSegClasses(t, c, p || h),
    g = u.cssToStr(this.getSkinCss(d));

if (f.unshift("fc-time-grid-event", "fc-v-event"), o.isMultiDayRange(a.unzonedRange)) {
    if (t.isStart || t.isEnd) {
        var v = s.msToMoment(t.startMs),
            y = s.msToMoment(t.endMs);
        n = this._getTimeText(v, y, l),
            r = this._getTimeText(v, y, l, "LT"),
            i = this._getTimeText(v, y, l, null, !1)
    }
} else {
    n = this.getTimeText(t.footprint),
        r = this.getTimeText(t.footprint, "LT"),
        i = this.getTimeText(t.footprint, null, !1);
}

return '<a class="' + f.join(" ") + '"' + (d.url ? ' href="' + u.htmlEscape(d.url) + '"' : "") + (g ? ' style="' + g + '"' : "") + '><div class="fc-content">' + (n ? '<div class="fc-time" data-start="' + u.htmlEscape(i) + '" data-full="' + u.htmlEscape(r) + '"><span>' + u.htmlEscape(n) + "</span></div>" : "") + (d.title ? '<div class="fc-title">' + u.htmlEscape(d.title) + "</div>" : "") + '</div><div class="fc-bg"></div>' + (h ? '<div class="fc-resizer fc-end-resizer"></div>' : "") + "</a>";

e.prototype.updateFgSegCoords = function(t) {
    this.timeGrid.computeSegVerticals(t),
        this.computeFgSegHorizontals(t),
        this.timeGrid.assignSegVerticals(t),
        this.assignFgSegHorizontals(t)
};

e.prototype.computeFgSegHorizontals = function(t) {
    var e, n, s;
    if (this.sortEventSegs(t), e = r(t), i(e), n = e[0]) {
        for (s = 0; s < n.length; s++) o(n[s]);
        for (s = 0; s < n.length; s++) this.computeFgSegForwardBack(n[s], 0, 0)
    }
};

e.prototype.computeFgSegForwardBack = function(t, e, n) {
    var r, i = t.forwardSegs;
    if (void 0 === t.forwardCoord) {
        for (i.length ? (this.sortForwardSegs(i), this.computeFgSegForwardBack(i[0], e + 1, n), t.forwardCoord = i[0].backwardCoord) : t.forwardCoord = 1, t.backwardCoord = t.forwardCoord - (t.forwardCoord - n) / (e + 1), r = 0; r < i.length; r++) this.computeFgSegForwardBack(i[r], 0, t.forwardCoord)
    }
};

e.prototype.sortForwardSegs = function(t) {
    t.sort(u.proxy(this, "compareForwardSegs"))
};

e.prototype.compareForwardSegs = function(t, e) {
    return e.forwardPressure - t.forwardPressure || (t.backwardCoord || 0) - (e.backwardCoord || 0) || this.compareEventSegs(t, e)
};

e.prototype.assignFgSegHorizontals = function(t) {
    var e, n;
    for (e = 0; e < t.length; e++) n = t[e], n.el.css(this.generateFgSegHorizontalCss(n)), n.footprint.eventDef.title && n.bottom - n.top < 30 && n.el.addClass("fc-short")
};

e.prototype.generateFgSegHorizontalCss = function(t) {
    var e, n, r = this.opt("slotEventOverlap"),
        i = t.backwardCoord,
        o = t.forwardCoord,
        s = this.timeGrid.generateSegVerticalCss(t),
        a = this.timeGrid.isRTL;
    return r && (o = Math.min(1, i + 2 * (o - i))), a ? (e = 1 - o, n = i) : (e = i, n = 1 - o), s.zIndex = t.level + 1, s.left = 100 * e + "%", s.right = 100 * n + "%", r && t.forwardPressure && (s[a ? "marginLeft" : "marginRight"] = 20), s
};
